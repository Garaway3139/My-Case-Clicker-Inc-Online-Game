<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Clicker Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chat-message { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .server-message { color: #00ffff; font-style: italic; }
        .player-message .sender { font-weight: bold; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a202c; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        .skin-card { transition: all 0.2s ease-in-out; }
        .skin-card.selected { border-color: #00ffff; transform: scale(1.05); box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); }
    </style>
</head>
<body class="bg-gray-900 text-cyan-300 overflow-hidden h-screen">

    <div id="game-container" class="hidden w-full h-screen p-4 flex flex-col md:flex-row gap-4">
        
        <div class="flex-grow flex flex-col gap-4 w-full md:w-1/3">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 id="username-display" class="text-2xl font-bold text-white">Player</h2>
                <div class="grid grid-cols-2 gap-2 mt-2 text-lg">
                    <p>üí∞ Money: <span id="money-stat" class="font-mono text-green-400">0</span></p>
                    <p>üñ±Ô∏è Clicks: <span id="clicks-stat" class="font-mono text-yellow-400">0</span></p>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg flex-grow flex flex-col items-center justify-center">
                <button id="click-button" class="bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-bold text-4xl py-16 px-24 rounded-full transition-transform transform hover:scale-105 active:scale-95 shadow-2xl">Click!</button>
                <div class="grid grid-cols-3 gap-2 mt-8 w-full">
                    <button onclick="openModal('shop-modal')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg">Shop</button>
                    <button onclick="openModal('inventory-modal')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg">Inventory</button>
                    <button onclick="openModal('admin-modal')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg">Admin</button>
                </div>
            </div>
        </div>

        <div class="flex flex-col gap-4 w-full md:w-2/3 h-full">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg flex-grow flex flex-col h-1/2">
                <h3 class="text-xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Players Online</h3>
                <ul id="player-list" class="overflow-y-auto space-y-1 pr-2"></ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg flex-grow flex flex-col h-1/2">
                <h3 class="text-xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Global Chat</h3>
                <div id="chat-box" class="flex-grow overflow-y-auto mb-2 pr-2 space-y-2"></div>
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-grow bg-gray-700 text-white rounded-lg p-2" placeholder="Type a message...">
                    <button id="send-chat-button" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="login-screen" class="w-full h-screen flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl text-center w-full max-w-sm">
            <h1 class="text-4xl font-bold text-white mb-4">Case Clicker Online</h1>
            <input type="text" id="username-input" class="w-full bg-gray-700 text-white rounded-lg p-3 text-center text-lg" placeholder="Enter Username">
            <button id="login-button" class="w-full mt-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg text-lg">Login</button>
            <p id="login-error" class="text-red-400 mt-4 h-6"></p>
        </div>
    </div>

    <div id="shop-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl h-5/6 flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-2">
                <h2 class="text-2xl text-white font-bold">Case Shop</h2>
                <button onclick="closeModal('shop-modal')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="shop-case-list" class="flex-grow overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-2"></div>
        </div>
    </div>

    <div id="inventory-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-6xl h-5/6 flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-2">
                <h2 class="text-2xl text-white font-bold">Inventory</h2>
                <button onclick="closeModal('inventory-modal')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="flex flex-grow overflow-hidden gap-4">
                <div class="w-1/3 flex flex-col">
                    <h3 class="text-xl font-bold text-white mb-2">My Cases</h3>
                    <div id="inventory-case-list" class="flex-grow overflow-y-auto bg-gray-900 p-2 rounded-lg"></div>
                </div>
                <div class="w-2/3 flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-bold text-white">My Skins (<span id="skin-count">0</span>)</h3>
                        <div id="sell-button-container" class="hidden">
                            <button id="sell-selected-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Sell Selected (0)</button>
                        </div>
                    </div>
                    <div id="inventory-skin-list" class="flex-grow overflow-y-auto bg-gray-900 p-2 rounded-lg grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl h-5/6 flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-2">
                <h2 class="text-2xl text-white font-bold">Admin Panel</h2>
                <button onclick="closeModal('admin-modal')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="admin-login-view">
                <input type="password" id="admin-password-input" class="w-full bg-gray-700 text-white rounded-lg p-3 text-center" placeholder="Enter Admin Password">
                <button id="admin-submit-password" class="w-full mt-4 bg-cyan-600 text-white font-bold py-3 rounded-lg">Authenticate</button>
            </div>
            <div id="admin-data-view" class="hidden flex-grow overflow-hidden">
                <h3 class="text-xl font-bold text-white">Live Server Data</h3>
                <pre id="admin-data-pre" class="bg-gray-900 text-xs p-4 rounded-lg overflow-auto h-1/2 my-2"></pre>
                <h3 class="text-xl font-bold text-white mt-4">Admin Actions</h3>
                <div class="flex gap-4 items-center mt-2">
                    <input id="admin-target-user" class="bg-gray-700 p-2 rounded" placeholder="Target Username">
                    <button id="admin-kick-button" class="bg-red-600 p-2 rounded">Kick Player</button>
                    <input id="admin-money-amount" type="number" class="bg-gray-700 p-2 rounded w-24" placeholder="Amount">
                    <button id="admin-give-money-button" class="bg-green-600 p-2 rounded">Give Money</button>
                </div>
            </div>
        </div>
    </div>

<script>
// --- Client-Side Game Logic ---
const API_URL = window.location.origin;

// --- State Management ---
let gameState = {
    username: null,
    playerData: { clicks: 0, money: 0, skins: [], cases: {} },
    onlinePlayers: [],
    lastGlobalChatId: '0',
    adminPassword: null,
    selectedSkinIds: new Set(),
};
let gameData = {
    cases: {},
    skins: {},
    rarities: {}
};

// --- DOM Elements ---
const loginScreen = document.getElementById('login-screen');
const gameContainer = document.getElementById('game-container');
const usernameInput = document.getElementById('username-input');
const loginButton = document.getElementById('login-button');
const loginError = document.getElementById('login-error');
const usernameDisplay = document.getElementById('username-display');
const moneyStat = document.getElementById('money-stat');
const clicksStat = document.getElementById('clicks-stat');
const clickButton = document.getElementById('click-button');
const playerList = document.getElementById('player-list');
const chatBox = document.getElementById('chat-box');
const chatInput = document.getElementById('chat-input');
const sendChatButton = document.getElementById('send-chat-button');
const shopCaseList = document.getElementById('shop-case-list');
const inventoryCaseList = document.getElementById('inventory-case-list');
const inventorySkinList = document.getElementById('inventory-skin-list');
const skinCount = document.getElementById('skin-count');
const sellButtonContainer = document.getElementById('sell-button-container');
const sellSelectedBtn = document.getElementById('sell-selected-btn');
const adminLoginView = document.getElementById('admin-login-view');
const adminPasswordInput = document.getElementById('admin-password-input');
const adminSubmitPassword = document.getElementById('admin-submit-password');
const adminDataView = document.getElementById('admin-data-view');
const adminDataPre = document.getElementById('admin-data-pre');
const adminTargetUser = document.getElementById('admin-target-user');
const adminKickButton = document.getElementById('admin-kick-button');
const adminMoneyAmount = document.getElementById('admin-money-amount');
const adminGiveMoneyButton = document.getElementById('admin-give-money-button');

// --- API Helper ---
async function apiRequest(endpoint, body) {
    try {
        const response = await fetch(`${API_URL}${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.message || `HTTP error! status: ${response.status}`);
        }
        return data;
    } catch (error) {
        console.error(`API request to ${endpoint} failed:`, error);
        return { success: false, message: error.message };
    }