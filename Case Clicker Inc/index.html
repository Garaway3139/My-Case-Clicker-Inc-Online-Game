<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Clicker Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .chat-message { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .server-message { color: #00ffff; font-style: italic; }
        .player-message .sender { font-weight: bold; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a202c; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        .skin-card { transition: all 0.2s ease-in-out; cursor: pointer; border: 2px solid transparent; }
        .skin-card.selected { border-color: #00ffff; transform: scale(1.05); box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); }
        .tier-button.active { background-color: #00ffff; color: #1a202c; }
    </style>
</head>
<body class="bg-gray-900 text-cyan-300 overflow-hidden h-screen">

    <!-- Main Game Container -->
    <div id="game-container" class="hidden w-full h-screen p-4 flex flex-col md:flex-row gap-4">
        <div class="flex-grow flex flex-col gap-4 w-full md:w-1/3">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 id="username-display" class="text-2xl font-bold text-white">Player</h2>
                <div class="grid grid-cols-2 gap-2 mt-2 text-lg">
                    <p>üí∞ Money: <span id="money-stat" class="font-mono text-green-400">0</span></p>
                    <p>üñ±Ô∏è Clicks: <span id="clicks-stat" class="font-mono text-yellow-400">0</span></p>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg flex-grow flex flex-col items-center justify-center">
                <button id="click-button" class="bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-bold text-4xl py-16 px-24 rounded-full transition-transform transform hover:scale-105 active:scale-95 shadow-2xl">Click!</button>
                <div class="grid grid-cols-2 gap-2 mt-8 w-full">
                    <button onclick="openModal('shop-modal')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg">Shop</button>
                    <button onclick="openModal('inventory-modal')" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg">Inventory</button>
                </div>
            </div>
        </div>
        <div class="flex flex-col gap-4 w-full md:w-2/3 h-full">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg flex-grow flex flex-col h-1/2">
                <h3 class="text-xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Global Chat</h3>
                <div id="chat-box" class="flex-grow overflow-y-auto mb-2 pr-2 space-y-2"></div>
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-grow bg-gray-700 text-white rounded-lg p-2" placeholder="Type a message...">
                    <button id="send-chat-button" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="w-full h-screen flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl text-center w-full max-w-sm">
            <h1 class="text-4xl font-bold text-white mb-4">Case Clicker Online</h1>
            <div class="space-y-4">
                <input type="text" id="username-input" class="w-full bg-gray-700 text-white rounded-lg p-3 text-center text-lg" placeholder="Enter Username">
                <input type="password" id="password-input" class="w-full bg-gray-700 text-white rounded-lg p-3 text-center text-lg" placeholder="Enter Password">
            </div>
            <div class="grid grid-cols-2 gap-4 mt-4">
                <button id="login-button" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg text-lg">Login</button>
                <button id="signup-button" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg text-lg">Sign Up</button>
            </div>
            <button onclick="openModal('admin-modal')" class="w-full mt-4 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 rounded-lg">Admin Login</button>
            <p id="login-error" class="text-red-400 mt-4 h-6"></p>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shop-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-7xl h-full flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-4">
                <h2 class="text-3xl text-white font-bold">Case Shop</h2>
                <div class="text-2xl text-green-400 font-mono">üí∞ <span id="shop-money-stat">0</span></div>
                <button onclick="closeModal('shop-modal')" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="shop-tier-buttons" class="flex flex-wrap gap-2 mb-4 overflow-x-auto pb-2">
                <!-- Tier buttons will be generated here -->
            </div>
            <div id="shop-case-list" class="flex-grow overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-2"></div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventory-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-6xl h-5/6 flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-2">
                <h2 class="text-2xl text-white font-bold">Inventory</h2>
                <button onclick="closeModal('inventory-modal')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="flex flex-grow overflow-hidden gap-4">
                <div class="w-1/3 flex flex-col">
                    <h3 class="text-xl font-bold text-white mb-2">My Cases</h3>
                    <div id="inventory-case-list" class="flex-grow overflow-y-auto bg-gray-900 p-2 rounded-lg"></div>
                </div>
                <div class="w-2/3 flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-bold text-white">My Skins (<span id="skin-count">0</span>)</h3>
                        <div id="sell-button-container" class="hidden">
                            <button id="sell-selected-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Sell Selected (0)</button>
                        </div>
                    </div>
                    <div id="inventory-skin-list" class="flex-grow overflow-y-auto bg-gray-900 p-2 rounded-lg grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl h-5/6 flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-2">
                <h2 class="text-2xl text-white font-bold">Admin Panel</h2>
                <button onclick="closeModal('admin-modal')" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="admin-login-view">
                <input type="password" id="admin-password-input" class="w-full bg-gray-700 text-white rounded-lg p-3 text-center" placeholder="Enter Admin Password">
                <button id="admin-submit-password" class="w-full mt-4 bg-cyan-600 text-white font-bold py-3 rounded-lg">Authenticate</button>
            </div>
            <div id="admin-data-view" class="hidden flex-grow overflow-hidden flex-col">
                <h3 class="text-xl font-bold text-white">Online Players (<span id="admin-online-count">0</span>)</h3>
                <div id="admin-player-list" class="bg-gray-900 p-2 rounded-lg overflow-auto h-1/2 my-2"></div>
                <h3 class="text-xl font-bold text-white mt-4">Admin Actions</h3>
                <div class="flex gap-4 items-center mt-2 p-2 bg-gray-900 rounded-lg">
                    <input id="admin-target-user" class="bg-gray-700 p-2 rounded flex-grow" placeholder="Target Username">
                    <button id="admin-kick-button" class="bg-red-600 p-2 rounded">Kick</button>
                    <input id="admin-money-amount" type="number" class="bg-gray-700 p-2 rounded w-32" placeholder="Amount">
                    <button id="admin-give-money-button" class="bg-green-600 p-2 rounded">Give Money</button>
                </div>
            </div>
        </div>
    </div>

<script>
// --- Client-Side Game Logic ---
const API_URL = window.location.origin;

// --- State Management ---
let gameState = {
    username: null,
    password: null,
    playerData: { clicks: 0, money: 0, skins: [], cases: {} },
    lastGlobalChatId: '0',
    adminPassword: null,
    selectedSkinIds: new Set(),
};
let gameData = {
    cases: {},
    skins: {},
    rarities: {}
};
let gameLoopInterval = null;

// --- DOM Elements ---
const loginScreen = document.getElementById('login-screen');
const gameContainer = document.getElementById('game-container');
const usernameInput = document.getElementById('username-input');
const passwordInput = document.getElementById('password-input');
const loginButton = document.getElementById('login-button');
const signupButton = document.getElementById('signup-button');
const loginError = document.getElementById('login-error');
const usernameDisplay = document.getElementById('username-display');
const moneyStat = document.getElementById('money-stat');
const clicksStat = document.getElementById('clicks-stat');
const clickButton = document.getElementById('click-button');
const chatBox = document.getElementById('chat-box');
const chatInput = document.getElementById('chat-input');
const sendChatButton = document.getElementById('send-chat-button');
const shopCaseList = document.getElementById('shop-case-list');
const shopTierButtons = document.getElementById('shop-tier-buttons');
const shopMoneyStat = document.getElementById('shop-money-stat');
const inventoryCaseList = document.getElementById('inventory-case-list');
const inventorySkinList = document.getElementById('inventory-skin-list');
const skinCount = document.getElementById('skin-count');
const sellButtonContainer = document.getElementById('sell-button-container');
const sellSelectedBtn = document.getElementById('sell-selected-btn');
const adminModal = document.getElementById('admin-modal');
const adminLoginView = document.getElementById('admin-login-view');
const adminPasswordInput = document.getElementById('admin-password-input');
const adminSubmitPassword = document.getElementById('admin-submit-password');
const adminDataView = document.getElementById('admin-data-view');
const adminPlayerList = document.getElementById('admin-player-list');
const adminOnlineCount = document.getElementById('admin-online-count');
const adminTargetUser = document.getElementById('admin-target-user');
const adminKickButton = document.getElementById('admin-kick-button');
const adminMoneyAmount = document.getElementById('admin-money-amount');
const adminGiveMoneyButton = document.getElementById('admin-give-money-button');

// --- API Helper ---
async function apiRequest(endpoint, body) {
    try {
        const response = await fetch(`${API_URL}${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.message || `HTTP error! status: ${response.status}`);
        }
        return data;
    } catch (error) {
        console.error(`API request to ${endpoint} failed:`, error);
        loginError.textContent = error.message;
        return { success: false, message: error.message };
    }
}

// --- Local Storage Management ---
function saveCredentialsToLocalStorage() {
    try {
        const credentials = {
            username: gameState.username,
            password: gameState.password,
            adminPassword: gameState.adminPassword
        };
        localStorage.setItem('caseClickerCreds', JSON.stringify(credentials));
    } catch (e) {
        console.error("Failed to save credentials:", e);
    }
}

function loadCredentialsFromLocalStorage() {
    try {
        const savedCreds = localStorage.getItem('caseClickerCreds');
        if (savedCreds) {
            const parsed = JSON.parse(savedCreds);
            gameState.username = parsed.username || null;
            gameState.password = parsed.password || null;
            gameState.adminPassword = parsed.adminPassword || null;
        }
    } catch (e) {
        console.error("Failed to load credentials:", e);
        localStorage.removeItem('caseClickerCreds');
    }
}

// --- UI Rendering ---
function updateAllMoneyDisplays() {
    const money = Math.floor(gameState.playerData.money).toLocaleString();
    moneyStat.textContent = money;
    shopMoneyStat.textContent = money;
}

function updateUI() {
    if (!gameState.playerData) return;
    updateAllMoneyDisplays();
    clicksStat.textContent = (gameState.playerData.clicks || 0).toLocaleString();
    usernameDisplay.textContent = gameState.username;
    renderInventorySkins();
    renderInventoryCases();
    updateSellButton();
}

function addChatMessage(msgData) {
    const div = document.createElement('div');
    div.classList.add('chat-message');
    if (msgData.is_server_msg) {
        div.classList.add('server-message');
        div.textContent = msgData.msg;
    } else {
        div.classList.add('player-message');
        const senderSpan = document.createElement('span');
        senderSpan.className = 'sender';
        senderSpan.style.color = '#38b2ac';
        senderSpan.textContent = `${msgData.sender}: `;
        div.appendChild(senderSpan);
        div.append(msgData.msg);
    }
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function setupShopTiers() {
    shopTierButtons.innerHTML = '';
    for (let i = 1; i <= 20; i++) {
        const button = document.createElement('button');
        button.className = 'tier-button bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg';
        button.textContent = `T${i}`;
        button.onclick = () => renderShopCases(i);
        shopTierButtons.appendChild(button);
    }
}

function renderShopCases(tier) {
    // Highlight active tier button
    document.querySelectorAll('.tier-button').forEach((btn, index) => {
        btn.classList.toggle('active', index + 1 === tier);
    });

    shopCaseList.innerHTML = '';
    const filteredCases = Object.entries(gameData.cases).filter(([name, data]) => data.tier === tier);
    
    for (const [caseName, caseInfo] of filteredCases) {
        const div = document.createElement('div');
        div.className = 'bg-gray-700 p-4 rounded-lg flex flex-col items-center';
        div.innerHTML = `
            <h4 class="text-lg font-bold text-white text-center">${caseName}</h4>
            <p class="text-green-400 font-mono my-2">$${parseFloat(caseInfo.price).toLocaleString()}</p>
            <button class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg mt-auto" onclick="buyCase('${caseName}')">Buy</button>
        `;
        shopCaseList.appendChild(div);
    }
}

function renderInventorySkins() {
    inventorySkinList.innerHTML = '';
    if (!gameState.playerData.skins) gameState.playerData.skins = [];
    skinCount.textContent = gameState.playerData.skins.length;
    const sortedSkins = [...gameState.playerData.skins].sort((a, b) => b.value - a.value);

    sortedSkins.forEach(skin => {
        const rarity = gameData.skins[skin.name] || 'Common';
        const rarityInfo = gameData.rarities[rarity] || { color: 'gray' };
        const div = document.createElement('div');
        div.className = `skin-card bg-gray-800 p-2 rounded-lg flex flex-col items-center text-center`;
        if (gameState.selectedSkinIds.has(skin.id)) {
            div.classList.add('selected');
        }
        div.innerHTML = `
            <p class="text-sm font-bold" style="color: ${rarityInfo.color};">${skin.name}</p>
            <p class="text-xs text-green-300 font-mono">$${skin.value.toLocaleString()}</p>
        `;
        div.onclick = () => toggleSkinSelection(skin.id, div);
        inventorySkinList.appendChild(div);
    });
}

function renderInventoryCases() {
    inventoryCaseList.innerHTML = '';
    if (!gameState.playerData.cases) gameState.playerData.cases = {};
    for (const caseName in gameState.playerData.cases) {
        const count = gameState.playerData.cases[caseName];
        if (count > 0) {
            const div = document.createElement('div');
            div.className = 'bg-gray-700 p-3 rounded-lg flex justify-between items-center';
            div.innerHTML = `
                <div>
                    <h5 class="text-white font-bold">${caseName}</h5>
                    <p class="text-sm text-gray-400">Amount: ${count}</p>
                </div>
                <button class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-1 px-3 rounded" onclick="openCase('${caseName}')">Open</button>
            `;
            inventoryCaseList.appendChild(div);
        }
    }
}

function updateSellButton() {
    const selectedCount = gameState.selectedSkinIds.size;
    sellButtonContainer.classList.toggle('hidden', selectedCount === 0);
    if (selectedCount > 0) {
        sellSelectedBtn.textContent = `Sell Selected (${selectedCount})`;
    }
}

// --- Game Logic ---
async function handleLogin() {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value;
    if (!user || !pass) {
        loginError.textContent = 'Username and password are required.';
        return;
    }
    loginButton.disabled = true;
    signupButton.disabled = true;
    loginError.textContent = '';

    const result = await apiRequest('/api/login', { username: user, password: pass });

    if (result.success) {
        gameState.username = result.username; // Use display name from server
        gameState.password = pass;
        gameState.playerData = result.player_data;
        loginScreen.classList.add('hidden');
        gameContainer.classList.remove('hidden');
        saveCredentialsToLocalStorage();
        await loadStaticData();
        updateUI();
        startGameLoop();
    }
    loginButton.disabled = false;
    signupButton.disabled = false;
}

async function handleSignup() {
    const user = usernameInput.value.trim();
    const pass = passwordInput.value;
    if (!user || !pass) {
        loginError.textContent = 'Username and password are required for signup.';
        return;
    }
    loginButton.disabled = true;
    signupButton.disabled = true;
    loginError.textContent = '';
    
    const result = await apiRequest('/api/register', { username: user, password: pass });
    
    // Display message whether success or fail
    loginError.textContent = result.message;
    
    loginButton.disabled = false;
    signupButton.disabled = false;
}

async function handleClick() {
    clickButton.disabled = true;
    const result = await apiRequest('/api/click', { username: gameState.username });
    if (result.success) {
        gameState.playerData = result.player_data;
        updateUI();
    }
    // Re-enable after a short delay to prevent spam
    setTimeout(() => { clickButton.disabled = false; }, 100);
}

async function handleChatSend() {
    const message = chatInput.value;
    if (message.trim()) {
        chatInput.value = '';
        await apiRequest('/api/chat/global', { username: gameState.username, message: message });
    }
}

async function buyCase(caseName) {
    const result = await apiRequest('/api/buy_case', { username: gameState.username, case_name: caseName, quantity: 1 });
    if (result.success) {
        gameState.playerData = result.player_data;
        updateUI();
    } else {
        alert(result.message || "Failed to buy case.");
    }
}

async function openCase(caseName) {
    const result = await apiRequest('/api/open_case', { username: gameState.username, case_name: caseName });
    if (result.success) {
        gameState.playerData = result.player_data;
        updateUI();
        alert(`You unboxed a ${result.item_won.name} worth $${result.item_won.value.toLocaleString()}!`);
    } else {
        alert(result.message || "Failed to open case.");
    }
}

function toggleSkinSelection(skinId, element) {
    if (gameState.selectedSkinIds.has(skinId)) {
        gameState.selectedSkinIds.delete(skinId);
        element.classList.remove('selected');
    } else {
        gameState.selectedSkinIds.add(skinId);
        element.classList.add('selected');
    }
    updateSellButton();
}

async function sellSelectedSkins() {
    const ids = Array.from(gameState.selectedSkinIds);
    if (ids.length === 0) return;

    const result = await apiRequest('/api/sell_skins', { username: gameState.username, skin_ids: ids });
    if (result.success) {
        gameState.playerData = result.player_data;
        gameState.selectedSkinIds.clear();
        updateUI();
        alert(`Sold ${result.count} skins for $${result.value.toLocaleString()}.`);
    } else {
        alert(result.message || "Failed to sell skins.");
    }
}

// --- Modals & Admin ---
function openModal(modalId) { 
    document.getElementById(modalId).classList.add('active'); 
    if (modalId === 'shop-modal') {
        updateAllMoneyDisplays();
        // Default to showing Tier 1 when opening the shop
        if(!document.querySelector('.tier-button.active')) {
            renderShopCases(1);
        }
    }
}
function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }

async function handleAdminLogin() {
    const pass = adminPasswordInput.value;
    const result = await apiRequest('/api/admin/data', { password: pass });
    if (result.success) {
        gameState.adminPassword = pass;
        saveCredentialsToLocalStorage();
        adminLoginView.classList.add('hidden');
        adminDataView.style.display = 'flex';
        renderAdminPlayerList(result.online_players);
    } else {
        alert('Incorrect password.');
    }
}

function renderAdminPlayerList(players) {
    adminPlayerList.innerHTML = '';
    adminOnlineCount.textContent = players.length;
    players.forEach(p => {
        const div = document.createElement('div');
        div.className = 'bg-gray-700 p-2 rounded mb-2 flex justify-between items-center';
        div.innerHTML = `
            <div>
                <p class="font-bold text-white">${p.username}</p>
                <p class="text-sm text-cyan-400">Activity: ${p.activity}</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-green-400">$${p.money.toLocaleString()}</p>
                <p class="text-sm text-yellow-400">${p.clicks.toLocaleString()} Clicks</p>
            </div>
        `;
        div.onclick = () => { adminTargetUser.value = p.username; };
        adminPlayerList.appendChild(div);
    });
}

async function handleAdminAction(action) {
    const target_user = adminTargetUser.value;
    const amount = adminMoneyAmount.value;
    const body = {
        password: gameState.adminPassword,
        action: action,
        target_user: target_user,
        amount: action === 'give_money' ? amount : undefined
    };
    const result = await apiRequest('/api/admin/action', body);
    alert(result.message || "Action failed.");
    if(result.success) {
       const dataResult = await apiRequest('/api/admin/data', { password: gameState.adminPassword });
       if (dataResult.success) {
           renderAdminPlayerList(dataResult.online_players);
       }
    }
}

// --- Game Initialization & Loop ---
function startGameLoop() {
    if (gameLoopInterval) clearInterval(gameLoopInterval);
    gameLoopInterval = setInterval(updateGameState, 3000);
}

async function updateGameState() {
    if (!gameState.username) return;
    const result = await apiRequest('/api/game_state', {
        username: gameState.username,
        last_chat_id: gameState.lastGlobalChatId
    });

    if (result.success) {
        gameState.playerData = result.player_data;
        result.new_global_messages.forEach(msg => {
            addChatMessage(msg);
            gameState.lastGlobalChatId = msg.id;
        });
        updateUI();
        
        if (adminModal.classList.contains('active') && gameState.adminPassword) {
            const dataResult = await apiRequest('/api/admin/data', { password: gameState.adminPassword });
            if (dataResult.success) {
                renderAdminPlayerList(dataResult.online_players);
            }
        }
    } else {
        console.error("Game state update failed. Logging out.");
        clearInterval(gameLoopInterval);
        localStorage.removeItem('caseClickerCreds');
        location.reload();
    }
}

async function loadStaticData() {
    try {
        const [casesRes, skinsRes, raritiesRes] = await Promise.all([
            fetch(`${API_URL}/api/game_data/cases`).then(res => res.json()),
            fetch(`${API_URL}/api/game_data/skins`).then(res => res.json()),
            fetch(`${API_URL}/api/game_data/rarities`).then(res => res.json())
        ]);
        gameData.cases = casesRes;
        gameData.skins = skinsRes;
        gameData.rarities = raritiesRes;
        setupShopTiers();
    } catch (e) {
        console.error("Failed to load static game data:", e);
        loginError.textContent = "Could not connect to game servers.";
    }
}

function initGame() {
    loadCredentialsFromLocalStorage();
    
    loginButton.addEventListener('click', handleLogin);
    signupButton.addEventListener('click', handleSignup);
    passwordInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleLogin());
    clickButton.addEventListener('click', handleClick);
    sendChatButton.addEventListener('click', handleChatSend);
    chatInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleChatSend());
    sellSelectedBtn.addEventListener('click', sellSelectedSkins);
    adminSubmitPassword.addEventListener('click', handleAdminLogin);
    adminKickButton.addEventListener('click', () => handleAdminAction('kick'));
    adminGiveMoneyButton.addEventListener('click', () => handleAdminAction('give_money'));

    if (gameState.username && gameState.password) {
        usernameInput.value = gameState.username;
        passwordInput.value = gameState.password;
        handleLogin();
    }
}

// --- Start the application ---
initGame();
</script>

</body>
</html>
